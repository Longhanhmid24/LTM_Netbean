-- phpMyAdmin SQL Dump
-- version 5.2.1
-- https://www.phpmyadmin.net/
--
-- Host: 127.0.0.1:3306
-- Generation Time: Oct 28, 2025 at 06:50 AM
-- Server version: 9.1.0
-- PHP Version: 8.3.14

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `chat_app`
--

-- --------------------------------------------------------

--
-- Table structure for table `friendships`
--

DROP TABLE IF EXISTS `friendships`;
CREATE TABLE IF NOT EXISTS `friendships` (
  `user_id_1` int UNSIGNED NOT NULL COMMENT 'ID người dùng 1',
  `user_id_2` int UNSIGNED NOT NULL COMMENT 'ID người dùng 2',
  `status` enum('pending','accepted','blocked') COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'pending' COMMENT 'Trạng thái: đang chờ, chấp nhận, đã chặn',
  `action_user_id` int UNSIGNED NOT NULL COMMENT 'ID của người dùng thực hiện hành động cuối cùng',
  PRIMARY KEY (`user_id_1`,`user_id_2`),
  KEY `user_id_2` (`user_id_2`),
  KEY `action_user_id` (`action_user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `groups`
--

DROP TABLE IF EXISTS `groups`;
CREATE TABLE IF NOT EXISTS `groups` (
  `id` int UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ID duy nhất của nhóm',
  `name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Tên nhóm',
  `creator_id` int UNSIGNED NOT NULL COMMENT 'ID người tạo nhóm',
  `avatar` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Thời điểm tạo nhóm',
  PRIMARY KEY (`id`),
  KEY `creator_id` (`creator_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `group_calls`
--

DROP TABLE IF EXISTS `group_calls`;
CREATE TABLE IF NOT EXISTS `group_calls` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ID duy nhất của cuộc gọi nhóm',
  `group_id` int UNSIGNED NOT NULL COMMENT 'ID nhóm',
  `initiator_id` int UNSIGNED NOT NULL COMMENT 'ID người khởi tạo cuộc gọi',
  `call_type` enum('audio','video') COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Loại cuộc gọi: audio (thoại) hay video',
  `status` enum('active','ended') COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Trạng thái cuộc gọi',
  `start_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Thời điểm bắt đầu cuộc gọi',
  `end_time` timestamp NULL DEFAULT NULL COMMENT 'Thời điểm kết thúc cuộc gọi',
  PRIMARY KEY (`id`),
  KEY `group_id` (`group_id`),
  KEY `initiator_id` (`initiator_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `group_members`
--

DROP TABLE IF EXISTS `group_members`;
CREATE TABLE IF NOT EXISTS `group_members` (
  `group_id` int UNSIGNED NOT NULL COMMENT 'ID nhóm',
  `member_id` int UNSIGNED NOT NULL COMMENT 'ID thành viên',
  `role` enum('admin','member') COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'member' COMMENT 'Vai trò trong nhóm',
  PRIMARY KEY (`group_id`,`member_id`),
  KEY `member_id` (`member_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `group_messages`
--

DROP TABLE IF EXISTS `group_messages`;
CREATE TABLE IF NOT EXISTS `group_messages` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ID duy nhất của tin nhắn nhóm',
  `group_id` int UNSIGNED NOT NULL COMMENT 'ID nhóm',
  `sender_id` int UNSIGNED NOT NULL COMMENT 'ID người gửi',
  `message_type` enum('text','image','file','video','audio') COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'text' COMMENT 'Loại tin nhắn: văn bản, ảnh, file, video, hoặc audio',
  `media_url` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `file_name` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Tên gốc của file (chỉ dùng nếu message_type là file)',
  `content` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `timestamp` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Thời điểm gửi tin nhắn',
  PRIMARY KEY (`id`),
  KEY `group_id` (`group_id`),
  KEY `sender_id` (`sender_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `private_calls`
--

DROP TABLE IF EXISTS `private_calls`;
CREATE TABLE IF NOT EXISTS `private_calls` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ID duy nhất của cuộc gọi',
  `caller_id` int UNSIGNED NOT NULL COMMENT 'ID người gọi',
  `receiver_id` int UNSIGNED NOT NULL COMMENT 'ID người nhận',
  `call_type` enum('audio','video') COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Loại cuộc gọi: audio (thoại) hay video',
  `status` enum('missed','completed','cancelled','failed') COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Trạng thái cuộc gọi',
  `start_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Thời điểm bắt đầu cuộc gọi (hoặc thời điểm gọi)',
  `end_time` timestamp NULL DEFAULT NULL COMMENT 'Thời điểm kết thúc cuộc gọi (NULL nếu bị nhỡ)',
  PRIMARY KEY (`id`),
  KEY `caller_id` (`caller_id`),
  KEY `receiver_id` (`receiver_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `private_messages`
--

DROP TABLE IF EXISTS `private_messages`;
CREATE TABLE IF NOT EXISTS `private_messages` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ID duy nhất của tin nhắn',
  `sender_id` int UNSIGNED NOT NULL COMMENT 'ID người gửi',
  `receiver_id` int UNSIGNED NOT NULL COMMENT 'ID người nhận',
  `message_type` enum('text','image','file','video','audio') COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'text' COMMENT 'Loại tin nhắn: văn bản, ảnh, file, video, hoặc audio',
  `media_url` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `file_name` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Tên gốc của file (chỉ dùng nếu message_type là file)',
  `content` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `timestamp` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Thời điểm gửi tin nhắn',
  PRIMARY KEY (`id`),
  KEY `sender_id` (`sender_id`),
  KEY `receiver_id` (`receiver_id`)
) ENGINE=InnoDB AUTO_INCREMENT=59 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `private_messages`
--

INSERT INTO `private_messages` (`id`, `sender_id`, `receiver_id`, `message_type`, `media_url`, `file_name`, `content`, `timestamp`) VALUES
(17, 1, 2, 'text', NULL, NULL, 'goodbye', '2025-10-25 05:58:25'),
(18, 1, 2, 'text', NULL, NULL, 'fafa', '2025-10-25 06:05:21'),
(19, 2, 1, 'text', NULL, NULL, 'hello', '2025-10-25 06:10:22'),
(20, 1, 2, 'text', NULL, NULL, 'Chào bạn', '2025-10-25 06:10:32'),
(21, 2, 1, 'text', NULL, NULL, 'cc', '2025-10-25 06:10:37'),
(22, 2, 1, 'text', NULL, NULL, 'hello', '2025-10-25 06:31:53'),
(23, 1, 2, 'file', 'http://localhost:8080/uploads/20251025133203_chat_app.txt', 'chat_app.txt', NULL, '2025-10-25 06:32:04'),
(24, 1, 2, 'text', NULL, NULL, 'hello', '2025-10-25 06:32:38'),
(25, 1, 2, 'file', 'http://localhost:8080/uploads/20251025133245_chat_app.txt', 'chat_app.txt', NULL, '2025-10-25 06:32:46'),
(26, 1, 2, 'text', NULL, NULL, 'hello', '2025-10-25 08:01:44'),
(27, 1, 2, 'text', NULL, NULL, 'daadd', '2025-10-25 08:01:47'),
(28, 1, 2, 'text', NULL, NULL, 'hưllo', '2025-10-25 08:03:35'),
(29, 2, 1, 'text', NULL, NULL, 'goodas', '2025-10-25 08:03:49'),
(30, 2, 1, 'file', 'http://localhost:8080/uploads/20251025150356_chat_app.txt', 'chat_app.txt', NULL, '2025-10-25 08:03:57'),
(31, 2, 1, 'text', NULL, NULL, 'hello', '2025-10-25 08:06:30'),
(32, 1, 2, 'text', NULL, NULL, 'đâf', '2025-10-25 08:06:37'),
(33, 1, 2, 'file', 'http://localhost:8080/uploads/20251025150649_chat_app.txt', 'chat_app.txt', NULL, '2025-10-25 08:06:49'),
(34, 2, 1, 'text', NULL, NULL, 'hwww', '2025-10-25 08:10:55'),
(35, 1, 2, 'file', 'http://localhost:8080/uploads/20251025151101_chat_app.txt', 'chat_app.txt', NULL, '2025-10-25 08:11:02'),
(36, 1, 2, 'text', NULL, NULL, 'dasdads', '2025-10-25 08:13:49'),
(37, 1, 2, 'file', 'http://localhost:8080/uploads/20251025151354_chat_app.txt', 'chat_app.txt', NULL, '2025-10-25 08:13:54'),
(38, 1, 2, 'image', 'http://localhost:8080/uploads/20251025152511_Screenshot 2025-06-13 003609.png', 'Screenshot 2025-06-13 003609.png', NULL, '2025-10-25 08:25:12'),
(39, 2, 1, 'image', 'http://localhost:8080/uploads/20251025152929_Untitled.jpg', 'Untitled.jpg', NULL, '2025-10-25 08:29:29'),
(40, 2, 1, 'text', NULL, NULL, 'hello', '2025-10-25 08:46:35'),
(41, 1, 2, 'text', NULL, NULL, 'dsafaf', '2025-10-25 08:46:42'),
(42, 1, 2, 'text', NULL, NULL, 'chào bạn', '2025-10-26 09:43:55'),
(43, 2, 1, 'text', NULL, NULL, 'Vo Phi Long Qua Dep Trai', '2025-10-26 09:45:57'),
(44, 2, 1, 'text', NULL, NULL, 'hai', '2025-10-26 10:01:03'),
(45, 1, 2, 'image', 'http://192.168.47.1:8080/uploads/20251026171216_Screenshot 2025-06-12 204944.png', '20251026171216_Screenshot 2025-06-12 204944.png', NULL, '2025-10-26 10:12:16'),
(46, 2, 1, 'image', 'http://192.168.47.1:8080/uploads/20251026171236_download.jpg', '20251026171236_download.jpg', NULL, '2025-10-26 10:12:36'),
(47, 2, 1, 'text', NULL, NULL, 'lô', '2025-10-26 12:36:39'),
(48, 2, 1, 'text', NULL, NULL, 'hello', '2025-10-27 01:52:52'),
(49, 2, 1, 'text', NULL, NULL, 'hello', '2025-10-27 01:55:57'),
(50, 1, 2, 'text', NULL, NULL, 'yo', '2025-10-27 01:56:18'),
(51, 2, 1, 'text', NULL, NULL, 'heloolada', '2025-10-27 02:04:13'),
(52, 1, 2, 'text', NULL, NULL, 'lô cc', '2025-10-27 02:04:22'),
(53, 2, 1, 'image', 'http://192.168.47.1:8080/uploads/20251027090424_download.webp', '20251027090424_download.webp', NULL, '2025-10-27 02:04:25'),
(54, 1, 2, 'image', 'http://192.168.47.1:8080/uploads/20251027090437_download.webp', '20251027090437_download.webp', NULL, '2025-10-27 02:04:37'),
(55, 2, 1, 'video', 'http://192.168.47.1:8080/uploads/20251027095831_lonelylonely.mp4', '20251027095831_lonelylonely.mp4', NULL, '2025-10-27 02:58:32'),
(56, 2, 1, 'video', 'http://192.168.47.1:8080/uploads/20251027100352_lonelylonely.mp4', '20251027100352_lonelylonely.mp4', NULL, '2025-10-27 03:03:52'),
(57, 2, 1, 'file', 'http://192.168.47.1:8080/uploads/20251027110448_chat_app.txt', '20251027110448_chat_app.txt', NULL, '2025-10-27 04:04:49'),
(58, 1, 2, 'text', NULL, NULL, 'alo', '2025-10-27 05:29:51');

-- --------------------------------------------------------

--
-- Table structure for table `users`
--

DROP TABLE IF EXISTS `users`;
CREATE TABLE IF NOT EXISTS `users` (
  `id` int UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ID duy nhất của người dùng',
  `username` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Tên đăng nhập / Tên hiển thị',
  `sdt` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `password` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Mật khẩu đã được Hash (Sử dụng Bcrypt/Argon2)',
  `avatar` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Thời điểm tạo tài khoản',
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'Thời điểm cập nhật gần nhất',
  `deleted_at` timestamp NULL DEFAULT NULL COMMENT 'Thời điểm người dùng bị đánh dấu xóa. NULL nếu tài khoản đang hoạt động.',
  `is_suspended` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'TRUE nếu tài khoản bị tạm khóa (Suspend).',
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`),
  UNIQUE KEY `sdt` (`sdt`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `users`
--

INSERT INTO `users` (`id`, `username`, `sdt`, `password`, `avatar`, `created_at`, `updated_at`, `deleted_at`, `is_suspended`) VALUES
(1, 'along', '123', '123', 'a.jpg', '2025-10-22 02:13:52', '2025-10-22 02:13:52', NULL, 0),
(2, 'long', '23235', '45661221', 'string', '2025-10-22 05:25:02', '2025-10-22 05:25:02', NULL, 0),
(3, 'londeptrai', '31233154', '$2a$10$o6T0zgQcQuuYkuv.D4wZyeThVyHZqPAM2eUaafULlIzq0cHkbXIpe', NULL, '2025-10-27 23:38:09', '2025-10-27 23:38:09', NULL, 0);

-- --------------------------------------------------------

--
-- Table structure for table `user_keys`
--

DROP TABLE IF EXISTS `user_keys`;
CREATE TABLE IF NOT EXISTS `user_keys` (
  `user_id` int NOT NULL,
  `public_key` text NOT NULL,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`user_id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

--
-- Constraints for dumped tables
--

--
-- Constraints for table `friendships`
--
ALTER TABLE `friendships`
  ADD CONSTRAINT `friendships_ibfk_1` FOREIGN KEY (`user_id_1`) REFERENCES `users` (`id`) ON DELETE RESTRICT,
  ADD CONSTRAINT `friendships_ibfk_2` FOREIGN KEY (`user_id_2`) REFERENCES `users` (`id`) ON DELETE RESTRICT,
  ADD CONSTRAINT `friendships_ibfk_3` FOREIGN KEY (`action_user_id`) REFERENCES `users` (`id`) ON DELETE RESTRICT;

--
-- Constraints for table `groups`
--
ALTER TABLE `groups`
  ADD CONSTRAINT `groups_ibfk_1` FOREIGN KEY (`creator_id`) REFERENCES `users` (`id`) ON DELETE RESTRICT;

--
-- Constraints for table `group_calls`
--
ALTER TABLE `group_calls`
  ADD CONSTRAINT `group_calls_ibfk_1` FOREIGN KEY (`group_id`) REFERENCES `groups` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `group_calls_ibfk_2` FOREIGN KEY (`initiator_id`) REFERENCES `users` (`id`) ON DELETE RESTRICT;

--
-- Constraints for table `group_members`
--
ALTER TABLE `group_members`
  ADD CONSTRAINT `group_members_ibfk_1` FOREIGN KEY (`group_id`) REFERENCES `groups` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `group_members_ibfk_2` FOREIGN KEY (`member_id`) REFERENCES `users` (`id`) ON DELETE RESTRICT;

--
-- Constraints for table `group_messages`
--
ALTER TABLE `group_messages`
  ADD CONSTRAINT `group_messages_ibfk_1` FOREIGN KEY (`group_id`) REFERENCES `groups` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `group_messages_ibfk_2` FOREIGN KEY (`sender_id`) REFERENCES `users` (`id`) ON DELETE RESTRICT;

--
-- Constraints for table `private_calls`
--
ALTER TABLE `private_calls`
  ADD CONSTRAINT `private_calls_ibfk_1` FOREIGN KEY (`caller_id`) REFERENCES `users` (`id`) ON DELETE RESTRICT,
  ADD CONSTRAINT `private_calls_ibfk_2` FOREIGN KEY (`receiver_id`) REFERENCES `users` (`id`) ON DELETE RESTRICT;

--
-- Constraints for table `private_messages`
--
ALTER TABLE `private_messages`
  ADD CONSTRAINT `private_messages_ibfk_1` FOREIGN KEY (`sender_id`) REFERENCES `users` (`id`) ON DELETE RESTRICT,
  ADD CONSTRAINT `private_messages_ibfk_2` FOREIGN KEY (`receiver_id`) REFERENCES `users` (`id`) ON DELETE RESTRICT;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
